import{d as F,r as f,p as A,o as b,w as a,c as L,F as R,z as I,H as O,I as H,b as s,J,a as e,D as K,K as Q,L as q,f as D,i as y,M as W,k as S,N as X,_ as $,O as Y,P as Z,n as h,Q as ee,A as te,g as le,R as ae,S as oe}from"./index-sNQxKyBm.js";import{f as ne}from"./formate-pXNZoF42.js";const E=F({__name:"ChannelList",props:{modelValue:{type:[String,Number]},width:{type:String}},emits:["update:modelValue"],setup(k,{emit:v}){const i=v,o=f([]);return(async()=>{const t=await H();o.value=t.data,console.log(o.value)})(),(t,c)=>{const x=s("el-option"),d=s("el-select");return b(),A(d,{modelValue:k.modelValue,placeholder:"请点击选择","onUpdate:modelValue":c[0]||(c[0]=m=>i("update:modelValue",m)),style:O({width:k.width})},{default:a(()=>[(b(!0),L(R,null,I(o.value,m=>(b(),A(x,{key:m.id,label:m.cate_name,value:m.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","style"])}}});async function se(k,v){try{const i=await J.get(k,{responseType:"arraybuffer"}),o=i.data,g=new Blob([o],{type:i.headers["content-type"]});return new File([g],v,{type:g.type})}catch(i){throw console.error("将图片转换为File对象时发生错误:",i),i}}const ue=["src"],ie=F({__name:"ArticleEdit",emits:["success"],setup(k,{expose:v,emit:i}){const o=i,g={title:"",cate_id:"",content:"",cover_img:"",state:""},t=f({title:"",cate_id:"",content:"",cover_img:"",state:""}),c=f(""),x=_=>{c.value=URL.createObjectURL(_.raw),t.value.cover_img=_.raw},d=f(!1),m=async _=>{t.value.state=_;const n=new FormData;Object.keys(t.value).forEach(u=>{const l=t.value[u];n.append(u,l)}),t.value.id?(await W(n)).code===0&&(S.success("修改成功"),d.value=!1,o("success")):(await X(n)).code===0&&(S.success("发布成功"),d.value=!1,o("success"))};return v({open:async _=>{if(d.value=!0,await K(),_.id){const n=await Q(_.id);n.code===0&&(t.value=n.data,c.value=q+t.value.cover_img,t.value.cover_img=await se(c.value,t.value.cover_img),console.log(t.value))}else t.value={...g},c.value=""}}),(_,n)=>{const u=s("el-input"),l=s("el-form-item"),V=s("Plus"),C=s("el-icon"),U=s("el-upload"),z=s("el-button"),B=s("el-form"),w=s("el-drawer");return b(),L("div",null,[e(w,{modelValue:d.value,"onUpdate:modelValue":n[5]||(n[5]=p=>d.value=p),title:t.value.id?"编辑文章":"发布文章",direction:"rtl",size:"50%"},{default:a(()=>[D("div",null,[e(B,{mode:t.value,"label-width":"100px"},{default:a(()=>[e(l,{label:"文章标题"},{default:a(()=>[e(u,{modelValue:t.value.title,"onUpdate:modelValue":n[0]||(n[0]=p=>t.value.title=p),autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(l,{label:"文章分类"},{default:a(()=>[e(E,{modelValue:t.value.cate_id,"onUpdate:modelValue":n[1]||(n[1]=p=>t.value.cate_id=p),width:"100%"},null,8,["modelValue"])]),_:1}),e(l,{label:"文章封面"},{default:a(()=>[e(U,{class:"avatar-uploader","auto-upload":!1,"show-file-list":!1,"on-change":x},{default:a(()=>[c.value?(b(),L("img",{key:0,src:c.value,class:"avatar"},null,8,ue)):(b(),A(C,{key:1,class:"avatar-uploader-icon"},{default:a(()=>[e(V)]),_:1}))]),_:1})]),_:1}),e(l,{label:"文章内容"},{default:a(()=>[e(u,{modelValue:t.value.content,"onUpdate:modelValue":n[2]||(n[2]=p=>t.value.content=p),type:"textarea",rows:6},null,8,["modelValue"])]),_:1}),e(l,null,{default:a(()=>[e(z,{onClick:n[3]||(n[3]=p=>m("草稿"))},{default:a(()=>[...n[6]||(n[6]=[y("草稿",-1)])]),_:1}),e(z,{type:"primary",onClick:n[4]||(n[4]=p=>m("已发布"))},{default:a(()=>[...n[7]||(n[7]=[y(" 发布 ",-1)])]),_:1})]),_:1})]),_:1},8,["mode"])])]),_:1},8,["modelValue","title"])])}}}),re=$(ie,[["__scopeId","data-v-e8a26a98"]]),ce={class:"header"},de=F({__name:"manage",setup(k){Y(async()=>{t()});const v=f(!0),i=f(7),o=f({pagenum:1,pagesize:5,cate_id:"",state:""}),g=f([]),t=async()=>{v.value=!0;const u=await Z(o.value);g.value=u.data,i.value=u.total,v.value=!1},c=()=>{o.value.pagenum=1,o.value.pagesize=5,o.value.cate_id="",o.value.state="",t()},x=async u=>{await ae.confirm("你确认删除该文章信息吗？","温馨提示",{type:"warning",confirmButtonText:"确认",cancelButtonText:"取消"}),await oe(u),S({message:"删除成功",type:"success"}),t()},d=f(),m=()=>{d.value.open({})},T=u=>{d.value.open(u)},_=async u=>{o.value.pagenum=1,o.value.pagesize=u,t()},n=async u=>{o.value.pagenum=u,t()};return(u,l)=>{const V=s("el-button"),C=s("el-form-item"),U=s("el-option"),z=s("el-select"),B=s("el-form"),w=s("el-table-column"),p=s("el-empty"),M=s("el-table"),N=s("el-pagination"),j=s("el-card"),G=ee("loading");return b(),L("div",null,[e(j,{class:"container"},{header:a(()=>[D("div",ce,[l[5]||(l[5]=D("span",null,"文章管理",-1)),e(V,{type:"primary",onClick:m},{default:a(()=>[...l[4]||(l[4]=[y("发布文章",-1)])]),_:1})])]),default:a(()=>[e(B,{inline:!0,class:"demo-form-inline"},{default:a(()=>[e(C,{label:"文章分类"},{default:a(()=>[e(E,{modelValue:o.value.cate_id,"onUpdate:modelValue":l[0]||(l[0]=r=>o.value.cate_id=r)},null,8,["modelValue"])]),_:1}),e(C,{label:"发布状态"},{default:a(()=>[e(z,{modelValue:o.value.state,"onUpdate:modelValue":l[1]||(l[1]=r=>o.value.state=r),placeholder:"请点击选择",clearable:""},{default:a(()=>[e(U,{label:"已发布",value:"已发布"}),e(U,{label:"草稿",value:"草稿"})]),_:1},8,["modelValue"])]),_:1}),e(C,null,{default:a(()=>[e(V,{type:"primary",onClick:t},{default:a(()=>[...l[6]||(l[6]=[y("搜索",-1)])]),_:1}),e(V,{type:"primary",onClick:c},{default:a(()=>[...l[7]||(l[7]=[y("重置",-1)])]),_:1})]),_:1})]),_:1}),h((b(),A(M,{data:g.value,class:"table"},{empty:a(()=>[e(p,{description:"没有数据"})]),default:a(()=>[e(w,{prop:"id",label:"序号"}),e(w,{prop:"title",label:"分类名称"}),e(w,{prop:"pub_date",label:"发表时间"},{default:a(({row:r})=>[y(te(le(ne)(r.pub_date)),1)]),_:1}),e(w,{prop:"state",label:"状态"}),e(w,{fixed:"right",label:"操作"},{default:a(({row:r})=>[e(V,{type:"danger",onClick:P=>x(r.id)},{default:a(()=>[...l[8]||(l[8]=[y(" 删除 ",-1)])]),_:1},8,["onClick"]),e(V,{type:"primary",onClick:P=>T(r)},{default:a(()=>[...l[9]||(l[9]=[y("编辑",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[G,v.value]]),e(N,{background:"",layout:" sizes,jumper, prev, pager, next,total",total:i.value,"current-page":o.value.pagenum,"onUpdate:currentPage":l[2]||(l[2]=r=>o.value.pagenum=r),"page-size":o.value.pagesize,"onUpdate:pageSize":l[3]||(l[3]=r=>o.value.pagesize=r),"page-sizes":[2,5,10,15],style:{"margin-top":"20px","justify-content":"flex-end"},onSizeChange:_,onCurrentChange:n},null,8,["total","current-page","page-size"])]),_:1}),e(re,{ref_key:"article",ref:d,onSuccess:t},null,512)])}}}),_e=$(de,[["__scopeId","data-v-c8bb92c5"]]);export{_e as default};
